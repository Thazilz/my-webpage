<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory Form</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    form { max-width: 400px; margin: auto; }
    input { width: 100%; margin-bottom: 10px; padding: 8px; }
    button { padding: 10px 20px; }
    .success { color: green; }
    .error { color: red; }
    #inventoryList { max-width: 400px; margin: 20px auto; }
    #inventoryList h3 { margin-bottom: 10px; }
    #inventoryList ul { list-style-type: none; padding-left: 0; }
    #inventoryList li { background: #f9f9f9; margin-bottom: 8px; padding: 10px; border-radius: 4px; }
    #inventoryList li strong { display: block; margin-bottom: 5px; }
    #nfcStatus { text-align: center; margin: 10px 0; font-weight: bold; }
  </style>
</head>
<body>

<nav>
  <a href="index.html">Home</a> |
  <a href="inventory.html">Inventory</a> |
  <a href="loan.html">Loan</a> |
  <a href="return.html">Return</a> |
  <a href="contact.html">Contact</a>
</nav>

<h2>Inventory Submission</h2>

<!-- ‚úÖ NFC Scan Button -->
<div style="text-align: center;">
  <button type="button" onclick="startNFC()">üì≤ Scan NFC Tag</button>
  <div id="nfcStatus"></div>
</div>

<form id="inventoryForm">
  <input type="text" id="itemName" placeholder="Inventory Item Name" required />
  <input type="number" id="amount" placeholder="Amount" min="1" required />
  <button type="submit">Submit</button>
</form>

<p id="responseMsg"></p>

<div id="inventoryList">
  <h3>Submitted Inventory:</h3>
  <ul id="inventoryUl"></ul>
</div>

<!-- ‚úÖ Main Script -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getDatabase, ref, push, serverTimestamp, onChildAdded } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA67aMWlPYaAeh_07o1EaP8mkA2-rhYsUs",
    authDomain: "my-webpage-93c94.firebaseapp.com",
    databaseURL: "https://my-webpage-93c94-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "my-webpage-93c94",
    storageBucket: "my-webpage-93c94.appspot.com",
    messagingSenderId: "959385466155",
    appId: "1:959385466155:web:e817821e92fa0acc6ec16e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const inventoryForm = document.getElementById('inventoryForm');
  const responseMsg = document.getElementById('responseMsg');
  const inventoryUl = document.getElementById('inventoryUl');

  const inventoryRef = ref(db, 'inventory');

  // üü¢ Load inventory items
  onChildAdded(inventoryRef, (data) => {
    const key = data.key;
    const { itemName, amount, timestamp } = data.val();

    const dateStr = (timestamp && typeof timestamp === "number")
      ? new Date(timestamp).toLocaleString()
      : "Pending timestamp...";

    const li = document.createElement('li');
    const strong = document.createElement('strong');
    strong.textContent = `${itemName} (Key: ${key}) - Quantity: ${amount}`;
    const time = document.createElement('em');
    time.textContent = `Submitted: ${dateStr}`;
    li.appendChild(strong);
    li.appendChild(time);
    inventoryUl.prepend(li);
  });

  // üü¢ Submit form
  inventoryForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const itemName = document.getElementById('itemName').value.trim();
    const amount = parseInt(document.getElementById('amount').value.trim(), 10);

    if (itemName === "" || isNaN(amount) || amount <= 0) {
      responseMsg.textContent = "Please enter a valid item and amount.";
      responseMsg.className = "error";
      return;
    }

    try {
      await push(inventoryRef, {
        itemName,
        amount,
        timestamp: serverTimestamp()
      });

      responseMsg.textContent = "Inventory submitted successfully!";
      responseMsg.className = "success";
      inventoryForm.reset();
    } catch (error) {
      console.error("‚ùå Firebase write error:", error);
      responseMsg.textContent = "Error submitting inventory. Check console.";
      responseMsg.className = "error";       
    }
  });

  // üü¢ NFC Function
  window.startNFC = async function () {
    const status = document.getElementById("nfcStatus");

    if ('NDEFReader' in window) {
      try {
        const ndef = new NDEFReader();
        await ndef.scan();
        status.textContent = "üì° NFC scanning... Tap a tag!";
        console.log("NFC scanning started");

        ndef.onreading = event => {
          const decoder = new TextDecoder();
          const { message, serialNumber } = event;

          console.log(`üìç Serial Number: ${serialNumber}`);
          const input = document.getElementById('itemName');
          input.value = serialNumber; // Default to serialNumber

          for (const record of message.records) {
            if (record.recordType === "text") {
              const text = decoder.decode(record.data);
              console.log(`üìù Text from tag: ${text}`);
              input.value = text; // Overwrite with readable label
              status.textContent = `‚úÖ Tag scanned: "${text}"`;
            }
          }
        };
      } catch (error) {
        console.error("NFC error:", error);
        status.textContent = "‚ö†Ô∏è NFC scan failed. See console.";
      }
    } else {
      status.textContent = "‚ùå Web NFC not supported in this browser.";
    }
  }
</script>

</body>
</html>






